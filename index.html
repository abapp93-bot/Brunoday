<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>BrunoDay ‚Äì Fan Club & Horror Nights</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://fonts.googleapis.com/css2?family=Anton&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bd-blue: #1687c8;
      --bd-yellow: #f7c744;
      --bd-red: #d3132f;
      --bd-dark: #050914;
      --bd-light: #f5f1da;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Roboto", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #101528 0, #020308 55%, #000 100%);
      color: var(--bd-light);
      line-height: 1.6;
    }

    a { color: var(--bd-yellow); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .page-wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 16px 48px;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
      border-bottom: 2px solid rgba(247, 199, 68, 0.25);
      padding-bottom: 16px;
    }

    .logo-box {
      flex: 0 0 120px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-box img {
      max-width: 100%;
      border-radius: 8px;
      box-shadow: 0 0 18px rgba(0, 0, 0, 0.8);
    }

    .hero-text { flex: 1; min-width: 260px; }

    .hero-title {
      font-family: "Anton", sans-serif;
      font-size: clamp(2.6rem, 4vw, 3.6rem);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--bd-yellow);
      text-shadow: -2px 2px 0 #000, 0 0 18px rgba(0, 0, 0, 0.9);
      margin-bottom: 8px;
      position: relative;
      display: inline-block;
    }

    .hero-title::after {
      content: "";
      position: absolute;
      bottom: -4px; left: 0;
      width: 100%; height: 4px;
      background: linear-gradient(to right, transparent 0%, var(--bd-red) 15%, var(--bd-red) 70%, transparent 100%);
      transform: skewX(-12deg);
      box-shadow: 0 0 12px rgba(211, 19, 47, 0.9);
    }

    .hero-subtitle {
      font-weight: 700;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--bd-blue);
      font-size: 0.95rem;
      margin-bottom: 10px;
    }

    .hero-tagline {
      font-size: 0.98rem;
      color: #ddd8bf;
      max-width: 520px;
    }

    .slasher-label {
      display: inline-block;
      margin-top: 10px;
      padding: 4px 10px;
      background: var(--bd-red);
      color: var(--bd-light);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      transform: skewX(-10deg);
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
    }

    section { margin-top: 32px; }

    .section-title {
      font-family: "Anton", sans-serif;
      font-size: 1.6rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      margin-bottom: 12px;
      color: var(--bd-yellow);
      text-shadow: -1px 1px 0 #000;
      position: relative;
      display: inline-block;
    }

    .section-title::before {
      content: "";
      position: absolute;
      left: -10px; top: 50%;
      width: 6px; height: 110%;
      background: var(--bd-red);
      transform: translateY(-50%) skewY(-10deg);
      box-shadow: 0 0 12px rgba(211, 19, 47, 0.9);
    }

    .card {
      background: radial-gradient(circle at top, #12213a 0, #050914 55%);
      border-radius: 14px;
      border: 1px solid rgba(247, 199, 68, 0.22);
      padding: 18px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.8);
      position: relative;
      overflow: hidden;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 2px 10px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.75);
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.17em;
      color: var(--bd-light);
      margin-bottom: 8px;
    }

    .badge-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--bd-red);
      box-shadow: 0 0 8px rgba(211, 19, 47, 0.9);
    }

    .next-film-grid {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.6fr);
      gap: 18px;
    }

    .film-title {
      font-family: "Anton", sans-serif;
      font-size: 1.5rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--bd-yellow);
      margin-bottom: 4px;
    }

    .film-meta {
      font-size: 0.9rem;
      color: #d5cfb5;
      margin-bottom: 10px;
    }

    .splatter {
      display: inline-block;
      padding: 4px 8px;
      background: radial-gradient(circle at top left, #ff3355 0, var(--bd-red) 40%, #5a020f 100%);
      border-radius: 10px 40px 25px 50px;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 10px;
    }

    ul { padding-left: 18px; margin-top: 6px; }
    li { margin-bottom: 4px; font-size: 0.92rem; }

    .rules-columns {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 18px;
    }

    .rules-highlight {
      background: linear-gradient(135deg, rgba(22, 135, 200, 0.2), rgba(5, 9, 20, 0.8));
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 0.9rem;
      border: 1px solid rgba(22, 135, 200, 0.5);
    }

    .film-list {
      list-style: none;
      margin-top: 8px;
    }

    .film-list li {
      padding: 6px 10px;
      border-radius: 8px;
      background: rgba(5, 9, 20, 0.85);
      border: 1px solid rgba(247, 199, 68, 0.12);
      margin-bottom: 6px;
      font-size: 0.9rem;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
    }

    .film-list span.title { color: var(--bd-yellow); font-weight: 600; }
    .film-list span.rating { font-size: 0.85rem; color: #f2d77c; white-space: nowrap; }

    .film-icon {
      margin-right: 6px;
      font-size: 1rem;
    }

    .cta-fanclub {
      display: grid;
      grid-template-columns: minmax(0, 1.8fr) minmax(0, 1.3fr);
      gap: 18px;
      align-items: center;
    }

    .fancard-mock {
      background: var(--bd-blue);
      border-radius: 14px;
      padding: 14px 16px;
      color: #021323;
      position: relative;
      overflow: hidden;
      border: 2px solid #000;
      box-shadow: 0 16px 30px rgba(0, 0, 0, 0.9);
    }

    .fancard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .fancard-title {
      font-family: "Anton", sans-serif;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 0.95rem;
      color: var(--bd-yellow);
      text-shadow: -1px 1px 0 #000;
    }

    .fancard-logo {
      font-size: 0.7rem;
      background: #000;
      color: var(--bd-yellow);
      padding: 4px 6px;
      border-radius: 999px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    .fancard-body {
      display: grid;
      grid-template-columns: 1.4fr 1fr;
      gap: 10px;
      align-items: center;
    }

    .fancard-lines {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    .fancard-line-label { display: block; margin-bottom: 4px; }
    .fancard-line { height: 1px; background: #000; margin-bottom: 8px; }

    .qr-placeholder {
      width: 70px; height: 70px;
      background: #f5f1da;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.55rem;
      text-align: center;
      padding: 4px;
    }

    /* Area Membri */
    .member-input-wrap {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-top: 8px;
    }

    .member-input-wrap input {
      flex: 1;
      min-width: 180px;
      padding: 6px 10px;
      border-radius: 6px;
      border: 1px solid rgba(247, 199, 68, 0.6);
      background: rgba(5, 9, 20, 0.9);
      color: var(--bd-light);
      font-size: 0.9rem;
    }

    .member-input-wrap button {
      padding: 7px 14px;
      border-radius: 6px;
      border: none;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      cursor: pointer;
      background: var(--bd-red);
      color: var(--bd-light);
      box-shadow: 0 0 10px rgba(211, 19, 47, 0.9);
    }

    .member-input-wrap button:hover { filter: brightness(1.1); }

    .member-hint {
      font-size: 0.8rem;
      color: #c4bba5;
      margin-top: 4px;
    }

    .member-secret {
      margin-top: 14px;
      padding-top: 10px;
      border-top: 1px dashed rgba(247, 199, 68, 0.4);
      display: none;
    }

    .secret-title {
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      margin-bottom: 6px;
      color: var(--bd-yellow);
    }

    .vote-button {
      display: inline-block;
      margin-top: 6px;
      padding: 7px 14px;
      border-radius: 999px;
      border: 1px solid rgba(247, 199, 68, 0.7);
      background: rgba(5, 9, 20, 0.9);
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
    }

    footer {
      margin-top: 40px;
      font-size: 0.8rem;
      color: #9b9380;
      text-align: center;
    }

    footer span {
      display: inline-block;
      margin-top: 4px;
      font-size: 0.78rem;
      opacity: 0.8;
    }

    /* Galleria foto */
    .photo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 10px;
    }

    .photo-grid img {
      width: 100%;
      border-radius: 8px;
      object-fit: cover;
      border: 2px solid rgba(247, 199, 68, 0.3);
      box-shadow: 0 0 14px rgba(0,0,0,0.6);
      transition: transform 0.2s ease;
    }

    .photo-grid img:hover {
      transform: scale(1.04);
    }

    /* Banner evento natalizio / horror */
    .event-banner {
      display: block;
      margin: 20px auto 30px;
      padding: 16px 20px;
      text-align: center;
      border-radius: 12px;
      text-decoration: none;
      color: var(--bd-light);
      font-family: "Anton", sans-serif;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 1.2rem;
      border: 2px solid var(--bd-yellow);
      background: rgba(0,0,0,0.55);
      box-shadow: 0 0 18px rgba(0,0,0,0.9);
      animation: bannerGlow 1.8s infinite ease-in-out;
      position: relative;
      overflow: hidden;
    }

    .event-banner::after {
      content: "";
      position: absolute;
      top: -50%;
      left: -20%;
      width: 40%;
      height: 200%;
      background: linear-gradient(
        120deg,
        transparent 0%,
        rgba(247,199,68,0.45) 40%,
        transparent 80%
      );
      opacity: 0.0;
      transform: translateX(-100%);
      animation: bannerShine 3.5s infinite;
    }

    .event-banner-content {
      position: relative;
      z-index: 1;
    }

    .event-banner-sub {
      font-family: "Roboto", sans-serif;
      text-transform: none;
      font-size: 0.9rem;
      letter-spacing: 0.05em;
      opacity: 0.9;
      margin-top: 4px;
    }

    .event-banner-icon {
      display: inline-block;
      margin: 0 6px;
      font-size: 1.4rem;
      animation: knifeFlicker 0.9s infinite alternate;
    }

    @keyframes bannerGlow {
      0%   { box-shadow: 0 0 12px var(--bd-yellow); border-color: var(--bd-yellow); }
      33%  { box-shadow: 0 0 14px var(--bd-red);    border-color: var(--bd-red); }
      66%  { box-shadow: 0 0 14px var(--bd-blue);   border-color: var(--bd-blue); }
      100% { box-shadow: 0 0 12px var(--bd-yellow); border-color: var(--bd-yellow); }
    }

    @keyframes bannerShine {
      0%   { opacity: 0; transform: translateX(-120%); }
      40%  { opacity: 0; }
      55%  { opacity: 0.7; transform: translateX(160%); }
      100% { opacity: 0; transform: translateX(160%); }
    }

    @keyframes knifeFlicker {
      0%   { transform: translateY(0) rotate(0deg); text-shadow: 0 0 4px rgba(211,19,47,0.9); }
      50%  { transform: translateY(-2px) rotate(-8deg); text-shadow: 0 0 8px rgba(211,19,47,1); }
      100% { transform: translateY(0) rotate(5deg); text-shadow: 0 0 6px rgba(22,135,200,0.9); }
    }

    .event-banner:hover {
      filter: brightness(1.15);
      transform: scale(1.02);
      transition: 0.2s;
    }

    @media (max-width: 780px) {
      .next-film-grid,
      .rules-columns,
      .cta-fanclub {
        grid-template-columns: minmax(0, 1fr);
      }

      header {
        justify-content: center;
        text-align: center;
      }

      .hero-text { text-align: center; }

      .hero-title::after {
        left: 50%;
        transform: translateX(-50%) skewX(-12deg);
      }

      .logo-box { flex: 0 0 90px; }

      .fancard-body {
        grid-template-columns: minmax(0, 1fr);
        justify-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="page-wrap">
    <header>
      <div class="logo-box">
        <img src="logo-brunoday.png" alt="BrunoDay Logo" />
      </div>
      <div class="hero-text">
        <div class="hero-subtitle">Horror Night Weekly Ritual</div>
        <h1 class="hero-title">BrunoDay</h1>
        <p class="hero-tagline">
          Una sera a settimana, la tana dell‚Äôorso si chiude, le luci si spengono
          e parte il film horror. Se sei qui, fai parte del cerchio.
        </p>
        <div class="slasher-label">Fan club ufficiale ‚Ä¢ ingresso su invito</div>
      </div>
    </header>

    <!-- Banner Evento Christmas -->
    <a href="evento.html" class="event-banner">
      <div class="event-banner-content">
        <span class="event-banner-icon">üî™</span>
        BRUNODAY EVENT ‚Äì CLICCA QUI
        <span class="event-banner-icon">üî™</span>
        <div class="event-banner-sub">
          Clicca qui per scoprire che cosa bolle in pentola...
        </div>
      </div>
    </a>

    <!-- Prossima proiezione -->
    <section id="next">
      <h2 class="section-title">Prossima Proiezione</h2>
      <div class="card">
        <div class="badge"><span class="badge-dot"></span> settimana in corso</div>
        <div class="next-film-grid">
          <div>
            <div class="splatter">Film della settimana</div>
            <h3 class="film-title">Un nuovo film tutto da scoprire</h3>
            <div class="film-meta">
              <strong>Data:</strong> Luned√¨, ore 21:00 ‚Äì <strong>Luogo:</strong> Cila City<br />
              <strong>Selezionato da:</strong> Spero non da Fede e da Giulia.
            </div>
            <p style="font-size: 0.9rem; color: #e1dac4;">
              Sicuramente un film Horror, sicuramente un film Brutto.
            </p>
          </div>
          <div>
            <p style="font-size: 0.88rem; color: #d5cfb5; margin-bottom: 6px;">
              <strong>Come funziona il BrunoDay:</strong>
            </p>
            <ul>
              <li>Ogni settimana si sceglie un film, horror.</li>
              <li>Commenti, meme e insulti cinematografici sono benvenuti.</li>
              <li>Presenze e vittorie vengono registrate nella Hall of Fame.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Regole -->
    <section id="rules">
      <h2 class="section-title">Regole del BrunoDay</h2>
      <div class="card">
        <div class="rules-columns">
          <div>
            <ul>
              <li>Niente spoiler su finali o colpi di scena prima del film.</li>
              <li>Chi arriva in ritardo porta gli snack alla serata successiva.</li>
              <li>Durante le scene top: niente scroll compulsivo sul telefono.</li>
              <li>Urla, risate e insulti al killer sono incoraggiati.</li>
              <li>Chi si addormenta viene fotografato e finisce negli annali.</li>
            </ul>
          </div>
          <div class="rules-highlight">
            <strong>Rito di inizio serata:</strong><br />
            "ok google spegni le luci!", logo BrunoDay sulla maglia, pop corn, birra e vino per Claudio.
          </div>
        </div>
      </div>
    </section>

    <!-- Archivio film (da Google Sheets) con Top/Flop + elenco completo -->
    <section id="archive">
      <h2 class="section-title">Archivio Film Visti</h2>
      <div class="card">
        <div class="member-input-wrap" style="margin-top:0; margin-bottom:12px;">
          <button type="button" onclick="loadFilms()">Aggiorna archivio (admin)</button>
        </div>

        <h3 style="font-size:0.95rem; text-transform:uppercase; letter-spacing:0.13em; color:var(--bd-yellow); margin-bottom:6px;">
          üé¨ Top 3 ‚Äì I pi√π apprezzati
        </h3>
        <ul id="filmTop" class="film-list">
          <li>
            <span class="title">Caricamento...</span>
            <span class="rating"></span>
          </li>
        </ul>

        <h3 style="font-size:0.95rem; text-transform:uppercase; letter-spacing:0.13em; color:var(--bd-yellow); margin:14px 0 6px;">
          üíÄ Flop 3 ‚Äì I pi√π massacrati
        </h3>
        <ul id="filmFlop" class="film-list">
          <li>
            <span class="title">Caricamento...</span>
            <span class="rating"></span>
          </li>
        </ul>

        <button id="archiveToggleBtn" type="button" onclick="toggleFullArchive()" 
                style="margin-top:12px; padding:6px 12px; border-radius:999px; border:1px solid rgba(247,199,68,0.7); background:rgba(5,9,20,0.9); color:var(--bd-light); font-size:0.8rem; text-transform:uppercase; letter-spacing:0.14em; cursor:pointer;">
          Mostra elenco completo
        </button>

        <div id="fullArchive" style="display:none; margin-top:10px;">
          <ul id="filmList" class="film-list">
            <li>
              <span class="title">Caricamento...</span>
              <span class="rating"></span>
            </li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Galleria Foto -->
    <section id="photos">
      <h2 class="section-title">Foto del BrunoDay</h2>
      <div class="card">
        <p style="font-size:0.9rem; margin-bottom:12px;">
          Momenti immortali delle nostre serate horror. Clicca sulle foto per vedere altre immagini.
        </p>

        <div class="photo-grid">
          <a href="https://photos.app.goo.gl/gsHsE5QKE69jXmNv8" target="_blank" class="photo-link">
            <img src="Maglietta.png" alt="Foto BrunoDay 1" />
          </a>

          <a href="https://photos.app.goo.gl/gsHsE5QKE69jXmNv8" target="_blank" class="photo-link">
            <img src="Disagio.jpeg" alt="Foto BrunoDay 2" />
          </a>

          <a href="https://photos.app.goo.gl/gsHsE5QKE69jXmNv8" target="_blank" class="photo-link">
            <img src="Foto3.jpeg" alt="Foto BrunoDay 3" />
          </a>

          <a href="https://photos.app.goo.gl/gsHsE5QKE69jXmNv8" target="_blank" class="photo-link">
            <img src="Foto4.jpeg" alt="Foto BrunoDay 4" />
          </a>
        </div>
      </div>
    </section>

    <!-- Fan club & tessera -->
    <section id="fanclub">
      <h2 class="section-title">Fan Club BrunoDay</h2>
      <div class="card">
        <div class="cta-fanclub">
          <div>
            <p>
              Solo chi possiede la <strong>Tessera Fan BrunoDay</strong> entra
              ufficialmente nel club: voto sul film, premi a
              fine stagione e comparsa nella Hall of Fame.
            </p>
          </div>

          <div class="fancard-mock">
            <div class="fancard-header">
              <div class="fancard-title">Fan Club ‚Ä¢ BrunoDay</div>
              <div class="fancard-logo">brunoday</div>
            </div>
            <div class="fancard-body">
              <div class="fancard-lines">
                <span class="fancard-line-label">Nome Cognome</span>
                <div class="fancard-line"></div>
                <span class="fancard-line-label">BD-001</span>
                <div class="fancard-line"></div>
              </div>
              <div class="qr-placeholder">
                QR CODE<br />
                (link a questa<br />
                landing)
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Area Membri -->
    <section id="members">
      <h2 class="section-title">Area Membri</h2>
      <div class="card">
        <p style="font-size:0.9rem;">
          Inserisci il tuo <strong>numero tessera BrunoDay</strong> per sbloccare l‚Äôarea riservata
          ai membri: link per il voto al film della settimana e contenuti bonus.
        </p>

        <div class="member-input-wrap">
          <input id="cardNumber" type="text" placeholder="Es. BD-001" />
          <button type="button" onclick="checkCard()">Entra</button>
        </div>
        <div class="member-hint">
          Il numero tessera √® scritto sul fronte della tua card Fan Club (formato: BD-001, BD-002, ecc.).
        </div>

        <div id="memberSecret" class="member-secret">
          <div class="secret-title">Zona Riservata Sbloccata</div>
          <p style="font-size:0.9rem;">
            Qui puoi votare il film della settimana e vedere i contenuti dedicati ai membri del BrunoDay.
          </p>

          <a href="https://docs.google.com/forms/d/e/1FAIpQLSckWE29uiRrQvdX0_L54_-jdCFbFInrg8zgbKIILYFsJPCm1Q/viewform?usp=header"
             target="_blank" class="vote-button">
            Vota il film della settimana
          </a>
        </div>
      </div>
    </section>

    <!-- Sezione Eco-Sostenibilit√† -->
    <section id="eco">
      <h2 class="section-title">BrunoDay √® Green</h2>

      <div class="card" style="text-align:left;">
        <div style="display:flex; align-items:center; gap:14px; margin-bottom:10px;">
          <div style="
            width:42px; height:42px; 
            border-radius:50%; 
            background:rgba(0,0,0,0.55);
            display:flex; align-items:center; justify-content:center;
            font-size:1.4rem;
            border:1px solid rgba(247,199,68,0.4);
          ">
            üå±
          </div>
          <h3 style="
            font-family:'Anton', sans-serif;
            letter-spacing:0.1em;
            color:var(--bd-yellow);
            text-transform:uppercase;
            font-size:1.2rem;
            margin:0;
          ">Energia Pulita</h3>
        </div>

        <p style="font-size:0.95rem; color:#dcd5c2;">
          Il BrunoDay non fa paura all‚Äôambiente.  
          Da quest‚Äôanno le nostre serate horror sono alimentate al <strong>100% da energia solare</strong>,
          grazie ai pannelli installati sul covo del Bruno.
        </p>

        <p style="font-size:0.9rem; margin-top:8px; color:#c8c1ae;">
          Tradotto: quando urli per un jumpscare, stai urlando a emissioni zero.  
          üé¨‚ö° <strong>BrunoDay diventa sostenibile</strong>, una serata alla volta.
        </p>
      </div>
    </section>

    <footer>
      BrunoDay ‚Äì Horror Night Fan Club<br />
      <span>‚ÄúSe senti un rumore‚Ä¶ √® solo Santa che ha fatto cadere qualcosa.‚Äù</span>
    </footer>
  </div>

  <script>
    const FILM_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRAqY-h7oSB53H-vCubXzvU3oLQuyWqSiBoblplMGWN5hTPFOfq4oHBKPKsbujUAr9nMmoMYdRfL0Dg/pub?output=csv";

    const validCards = [
      "BD-001","BD-002","BD-003","BD-004","BD-005","BD-006",
      "BD-007","BD-008","BD-009","BD-010","BD-011","BD-012"
    ];

    function checkCard() {
      const input = document.getElementById("cardNumber");
      const secret = document.getElementById("memberSecret");
      const value = input.value.trim().toUpperCase();

      if (validCards.includes(value)) {
        secret.style.display = "block";
      } else {
        secret.style.display = "none";
        alert("Numero tessera non valido üòà");
      }
    }

    let filmData = [];

    async function loadFilms() {
      const topUl  = document.getElementById("filmTop");
      const flopUl = document.getElementById("filmFlop");
      const fullUl = document.getElementById("filmList");
      if (!topUl || !flopUl || !fullUl) return;

      // reset iniziale
      const loadingLi = `
        <li>
          <span class="title">Caricamento...</span>
          <span class="rating"></span>
        </li>
      `;
      topUl.innerHTML  = loadingLi;
      flopUl.innerHTML = loadingLi;
      fullUl.innerHTML = loadingLi;

      if (!FILM_CSV_URL || FILM_CSV_URL.includes("INSERISCI_QUI_IL_LINK_CSV_DI_GOOGLE_SHEETS")) {
        const msg = `
          <li>
            <span class="title">Configura prima il link CSV di Google Sheets nel codice.</span>
            <span class="rating"></span>
          </li>
        `;
        topUl.innerHTML  = msg;
        flopUl.innerHTML = msg;
        fullUl.innerHTML = msg;
        return;
      }

      try {
        const res = await fetch(FILM_CSV_URL);
        const text = await res.text();

        const rows = text.trim().split("\n").slice(1); // salta intestazione
        filmData = [];

        rows.forEach(row => {
          const cols = row.split(",");
          const titolo = (cols[0] || "").trim();
          const anno   = (cols[1] || "").trim();
          const votoRaw = (cols[2] || "").trim();

          if (!titolo) return;

          let votoNum = parseFloat(votoRaw.replace(",", "."));
          if (isNaN(votoNum)) votoNum = null;

          filmData.push({
            titolo,
            anno,
            votoNum,
            votoTesto: votoRaw
          });
        });

        renderFilmLists();
      } catch (e) {
        console.error(e);
        const err = `
          <li>
            <span class="title">Errore nel caricare i dati.</span>
            <span class="rating"></span>
          </li>
        `;
        document.getElementById("filmTop").innerHTML  = err;
        document.getElementById("filmFlop").innerHTML = err;
        document.getElementById("filmList").innerHTML = err;
      }
    }

    function renderFilmLists() {
      const topUl  = document.getElementById("filmTop");
      const flopUl = document.getElementById("filmFlop");
      const fullUl = document.getElementById("filmList");

      topUl.innerHTML  = "";
      flopUl.innerHTML = "";
      fullUl.innerHTML = "";

      if (!filmData.length) {
        const empty = `
          <li>
            <span class="title">Nessun film ancora registrato.</span>
            <span class="rating"></span>
          </li>
        `;
        topUl.innerHTML  = empty;
        flopUl.innerHTML = empty;
        fullUl.innerHTML = empty;
        return;
      }

      const ratedFilms = filmData.filter(f => f.votoNum !== null);

      const top3 = [...ratedFilms]
        .sort((a, b) => b.votoNum - a.votoNum)
        .slice(0, 3);

      const flop3 = [...ratedFilms]
        .sort((a, b) => a.votoNum - b.votoNum)
        .slice(0, 3);

      const makeLi = (film, type) => {
        const li = document.createElement("li");

        if (type === "top" || type === "flop") {
          const iconSpan = document.createElement("span");
          iconSpan.className = "film-icon";
          iconSpan.textContent = type === "top" ? "üî•" : "üí©";
          li.appendChild(iconSpan);
        }

        const spanTitle = document.createElement("span");
        spanTitle.className = "title";
        spanTitle.textContent = film.anno
          ? `${film.titolo} (${film.anno})`
          : film.titolo;

        const spanRating = document.createElement("span");
        spanRating.className = "rating";
        spanRating.textContent = film.votoTesto
          ? `Voto: ${film.votoTesto}`
          : "";

        li.appendChild(spanTitle);
        li.appendChild(spanRating);
        return li;
      };

      if (top3.length) {
        top3.forEach(f => topUl.appendChild(makeLi(f, "top")));
      } else {
        topUl.innerHTML = `
          <li>
            <span class="title">Nessun voto ancora disponibile.</span>
            <span class="rating"></span>
          </li>
        `;
      }

      if (flop3.length) {
        flop3.forEach(f => flopUl.appendChild(makeLi(f, "flop")));
      } else {
        flopUl.innerHTML = `
          <li>
            <span class="title">Nessun voto ancora disponibile.</span>
            <span class="rating"></span>
          </li>
        `;
      }

      filmData.forEach(f => fullUl.appendChild(makeLi(f, null)));
    }

    function toggleFullArchive() {
      const box = document.getElementById("fullArchive");
      const btn = document.getElementById("archiveToggleBtn");
      if (!box || !btn) return;

      const isHidden = box.style.display === "none" || box.style.display === "";
      box.style.display = isHidden ? "block" : "none";
      btn.textContent = isHidden
        ? "Nascondi elenco completo"
        : "Mostra elenco completo";
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadFilms();
    });
  </script>
</body>
</html>
